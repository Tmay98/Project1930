<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Profile page</title>
    <style>
        .topcorner {
            position: absolute;
            top: 20px;
            right: 90px;
        }

        .links {
            padding-right: 30px;
        }

        #heading {
            background-color: lightskyblue
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/5.8.6/firebase.js"></script>
    <script src='firebase_setup.js'></script>
    <script type="text/javascript">
        var uid = null
        var displayName = null
        initApp = function () {
            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {
                    // User is signed in.
                    displayName = user.displayName;
                    uid = user.uid;
                    user.getIdToken().then(function (accessToken) {
                        document.getElementById('name').value = displayName;
                        firebase.database().ref().child("users/" + uid + "/address").on("value", function (snap) { document.getElementById('address').value = snap.val() })
                        firebase.database().ref().child("users/" + uid + "/date_of_birth").on("value", function (snap) { document.getElementById('date_of_birth').value = snap.val() })
                        firebase.database().ref().child("users/" + uid + "/restrictions").on("value", function (snap) { document.getElementById('restrictions').value = snap.val() })
                    });

                } else {

                }
            }, function (error) {
                console.log(error);
            });
        };

        window.addEventListener('load', function () {
            initApp()
        });
    </script>
</head>

<body>
    <h1 id="heading">Profile</h1>
    <p>Fill out your profile page!</p>
    <div class="topcorner">
        <a href="group_page.html" class="links">Groups</a>
        <a href="profile_page.html" class="links">Profile</a>
        <a href="login.html" onclick="FirebaseAuth.getInstance().signOut()">Log out</a>
    </div>
    <form id="form">
        Name: <input type="text" id="name"><br><br>
        Address: <input type="text" id="address"><br><br>
        Date of Birth (MM/DD/YY): <input type="text" id="date_of_birth"><br><br>
        Dietary Restrictions: <select id="restrictions">
            <option></option>
            <option value="vegan">Vegan</option>
            <option value="vegetarian">Vegetarian</option>
            <option value="halal">Halal</option>
            <option value="gluten">Gluten-Free</option>
            <option value="pescatarian">Pescatarian</option>
        </select><br><br>
    </form>
    <button onclick="saveform()">Send</button>
    <button>Cancel</button>
    <p id="saved"></p>

    <script>
        function saveform() {
            var database = firebase.database();
            var form = document.getElementById("form");
            var name = form.elements[0].value;
            var address = form.elements[1].value;
            var date_of_birth = form.elements[2].value;
            var restrictions = form.elements[3].value;
            firebase.database().ref("users/" + uid).set({
                name: displayName,
                address: address,
                date_of_birth: date_of_birth,
                restrictions: restrictions
            });
            document.getElementById("saved").innerHTML = "Your profile changes have been saved!"
            localStorage.setItem("name", name)
        }
    </script>
</body>

</html>